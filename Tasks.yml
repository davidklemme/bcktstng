roadmap:
  version: "0.1"
  updated: "2025-08-11"
  scope:
    markets: ["US", "EU"]
    latencies: ["EOD", "minute (later)"]
    base_currency: "EUR"
    interfaces_now: ["CLI", "HTTP (FastAPI)"]
    interfaces_later: ["gRPC", "Prefect"]
    parallelism: "multiprocessing"
  statuses_allowed: ["planned", "in_progress", "blocked", "done"]

epics:
  - id: E1
    title: Data Foundation (US+EU, FX, Calendars)
    status: done
    description: Point-in-time, survivorship-bias-free data with corporate actions, FX, and exchange calendars.
    acceptance_criteria:
      - "Schemas defined in PyArrow and documented."
      - "PIT symbol queries correct across active_from/active_to."
      - "Split/dividend adjustments validated."
      - "FX PIT queries and weekend handling validated."
      - "Calendars cover XNYS,XNAS,XETR,XLON,XPAR,XAMS,XBRU,SIX with DST/holidays."
    features:
      - id: E1-F1
        title: Arrow/Parquet Schemas
        status: done
        tasks:
          - id: T001
            title: Define schemas (bars, fx, corp_actions, symbols)
            status: done
            estimate: "0.5d"
            acceptance_criteria:
              - "Python constants in /data/schemas."
              - "Unit test instantiates each schema."
      - id: E1-F2
        title: Symbol Master + PIT
        status: done
        tasks:
          - id: T002
            title: Loader (CSV→Postgres) and PIT SELECTs
            status: done
            estimate: "1.0d"
            depends_on: [T001]
            acceptance_criteria:
              - "`get_symbols(asof)` returns only active rows."
              - "Tests cover survivorship bias with delistings."
      - id: E1-F3
        title: Corporate Actions
        status: done
        tasks:
          - id: T003
            title: Loader (CSV→Parquet) and adjusters
            status: done
            estimate: "1.0d"
            depends_on: [T002]
            acceptance_criteria:
              - "2:1 split halves price, doubles qty in P&L."
              - "Dividend cashflow reflected on ex-date."
      - id: E1-F4
        title: Exchange Calendars (US+EU)
        status: done
        tasks:
          - id: T004
            title: Calendar module (is_open/next_open/next_close)
            status: done
            estimate: "1.0d"
            acceptance_criteria:
              - "NYSE closed July 4; XETR half-day Dec 24 test passes."
      - id: E1-F5
        title: FX Rates (EUR base)
        status: done
        tasks:
          - id: T005
            title: FX ingestion (daily+minute) and PIT reader
            status: done
            estimate: "0.75d"
            depends_on: [T001]
            acceptance_criteria:
              - "USD/EUR, GBP/EUR, CHF/EUR stored."
              - "Weekend queries return last available."
      - id: E1-F6
        title: Bars Ingestion (Daily, US+EU)
        status: done
        tasks:
          - id: T006
            title: CSV→Parquet loader with validation
            status: done
            estimate: "1.0d"
            depends_on: [T001, T004]
            acceptance_criteria:
              - "UTC-normalized closes; gaps/NaNs flagged."
      - id: E1-F7
        title: PIT Data Reader API
        status: done
        tasks:
          - id: T007
            title: get_bars/get_fx with no-peek guard
            status: done
            estimate: "1.0d"
            depends_on: [T002, T003, T006]
            acceptance_criteria:
              - "Access beyond asof raises error; tests included."
      - id: E1-F8
        title: Region-Aware Cost Profiles
        status: done
        tasks:
          - id: T008
            title: YAML cost profiles per venue (US/EU)
            status: done
            estimate: "0.5d"
            acceptance_criteria:
              - "US per-share+SEC/TAF; EU bps; UK stamp duty toggle."

  - id: E2
    title: Engine Core (Events, Clock, Portfolio, Execution, Risk)
    status: done
    description: Deterministic event-driven simulator with multi-currency portfolio and realistic costs.
    acceptance_criteria:
      - "Deterministic event ordering."
      - "Accurate P&L with splits/dividends and FX."
      - "Fills respect spread and liquidity."
      - "Risk limits enforced."
    features:
      - id: E2-F1
        title: Events & Clock
        status: done
        tasks:
                      - id: T101
              title: Event types & priority queue
              status: done
            estimate: "0.75d"
            depends_on: [T007]
            acceptance_criteria:
              - "Bar/FX/CorpAction/Clock ordering test passes."
          - id: T102
            title: Deterministic clock (UTC, exchange-aware)
            status: done
            estimate: "0.5d"
            depends_on: [T101, T004]
            acceptance_criteria:
              - "No time travel; mixed feeds tested."
      - id: E2-F2
        title: Portfolio (Multi-Currency)
        status: done
        tasks:
                      - id: T103
              title: Positions, cash per CCY, EUR valuation
              status: done
            estimate: "1.5d"
            depends_on: [T005]
            acceptance_criteria:
              - "Realized/unrealized P&L correct across corp actions."
      - id: E2-F3
        title: Orders & Execution
        status: done
        tasks:
                      - id: T104
              title: Order state machine (NEW→WORKING→FILLED/CANCELED)
              status: done
            estimate: "0.75d"
            depends_on: [T101]
            acceptance_criteria:
              - "IOC/FOK/Day lifecycle tests."
                      - id: T105
              title: Execution simulator v1 (spread+liquidity)
              status: done
            estimate: "1.0d"
            depends_on: [T104, T006]
            acceptance_criteria:
              - "Fills within [bid, ask]; partials under ADV cap."
                      - id: T106
              title: Commission & fees plugin (US/EU)
              status: done
            estimate: "0.5d"
            depends_on: [T008]
            acceptance_criteria:
              - "Venue overrides applied; regression tests."
                      - id: T107
              title: Market impact (square-root)
              status: done
            estimate: "0.5d"
            depends_on: [T105]
            acceptance_criteria:
              - "Impact scales with sqrt(qty/ADV); unit tests."
      - id: E2-F4
        title: Risk Limits
        status: done
        tasks:
                      - id: T108
              title: Gross/net, per-symbol, leverage caps
              status: done
            estimate: "0.75d"
            depends_on: [T103]
            acceptance_criteria:
              - "Breaches block orders; logs include reason."

  - id: E3
    title: Strategy SDK & Features
    status: done
    description: Python SDK for writing strategies with context, data access, order APIs, and core indicators.
    acceptance_criteria:
      - "Strategy base class with ctx methods."
      - "Feature library validated against reference calcs."
      - "Example strategies runnable."
    features:
      - id: E3-F1
        title: Strategy Base & Context
        status: done
        tasks:
                      - id: T201
              title: Implement base & ctx (data/order/portfolio/risk/log)
              status: done
            estimate: "1.0d"
            depends_on: [T101, T103, T105]
            acceptance_criteria:
              - "Mock strategy receives expected events."
      - id: E3-F2
        title: Feature Library v1
        status: done
        tasks:
                      - id: T202
              title: MA, zscore, rolling vol, ATR, vol-target
              status: done
            estimate: "0.75d"
            depends_on: [T201]
            acceptance_criteria:
              - "Vectorized; unit tests pass."
      - id: E3-F3
        title: Example Strategies
        status: done
        tasks:
                      - id: T203
              title: MA cross and vol-targeted carry
              status: done
            estimate: "0.75d"
            depends_on: [T202]
            acceptance_criteria:
              - "Baseline metrics snapshot committed."

  - id: E4
    title: Orchestration & Service (CLI, HTTP, cron)
    status: done
    description: Expose backtests and signals via CLI and FastAPI; cron-aligned EOD runs.
    acceptance_criteria:
      - "CLI for backtest/signal/data ingest."
      - "HTTP /backtest and /signal return JSON artifacts."
      - "Cron scripts align to exchange close with retry."
    features:
      - id: E4-F1
        title: CLI
        status: done
        tasks:
          - id: T302
            title: Commands: run backtest|signal, data ingest
            status: done
            estimate: "0.75d"
            depends_on: [T201, T301]
            acceptance_criteria:
              - "Exit codes + help texts."
      - id: E4-F2
        title: FastAPI Service
        status: done
        tasks:
          - id: T303
            title: /health, /backtest, /signal (pydantic models)
            status: done
            estimate: "1.0d"
            depends_on: [T201, T301]
            acceptance_criteria:
              - "JSON logs; schema-validated requests."
      - id: E4-F3
        title: Containerization & Config
        status: done
        tasks:
          - id: T304
            title: Dockerfile/compose + pydantic config + .env
            status: done
            estimate: "0.5d"
            depends_on: [T303]
            acceptance_criteria:
              - "Service runs locally via docker-compose."
      - id: E4-F4
        title: Cron Runners
        status: done
        tasks:
          - id: T305
            title: Exchange-close cron scripts with offsets
            status: done
            estimate: "0.5d"
            depends_on: [T303, T004]
            acceptance_criteria:
              - "Retry on failure; timezone-safe schedule."

  - id: E5
    title: Paper & Live Execution Abstractions
    status: done
    description: Unified execution layer so strategies run unchanged in backtest, paper, or live.
    acceptance_criteria:
      - "Paper broker with same slippage/fees path."
      - "Execution provider interface."
      - "IBKR adapter skeleton (paper only)."
    features:
      - id: E5-F1
        title: Paper Broker
        status: done
        tasks:
          - id: T401
            title: In-memory order book, partial fills, cancel/replace
            status: done
            estimate: "1.0d"
            depends_on: [T105, T106]
            acceptance_criteria:
              - "Tick-size compliance US/EU; tests pass."
      - id: E5-F2
        title: Execution Provider Interface
        status: done
        tasks:
          - id: T402
            title: submit/cancel/status with unified errors
            status: done
            estimate: "0.5d"
            depends_on: [T401]
            acceptance_criteria:
              - "Mock adapter integration test."
      - id: E5-F3
        title: IBKR Adapter (skeleton)
        status: done
        tasks:
          - id: T403
            title: Auth, clock sync, dry-run guard (paper-only)
            status: done
            estimate: "1.0d"
            depends_on: [T402]
            acceptance_criteria:
              - "End-to-end dry-run through adapter."

  - id: E6
    title: Research & Validation (Walk-Forward, Hyperparam)
    status: done
    description: Leakage-safe validation and multiprocessing hyperparameter search.
    acceptance_criteria:
      - "Walk-forward & purged k-fold implemented."
      - "MP grid/random search with deterministic seeds."
    features:
      - id: E6-F1
        title: Walk-Forward & Purged K-Fold
        status: done
        tasks:
          - id: T501
            title: API with per-fold artifacts and leakage guards
            status: done
            estimate: "1.0d"
            depends_on: [T302]
            acceptance_criteria:
              - "No overlap; artifacts per fold saved."
      - id: E6-F2
        title: Hyperparameter Search (MP)
        status: done
        tasks:
          - id: T502
            title: Grid/random search; leaderboard.csv
            status: done
            estimate: "0.75d"
            depends_on: [T501]
            acceptance_criteria:
              - "Reproducible with fixed seeds."

  - id: E7
    title: Minute Bars & EU Specifics
    status: done
    description: Add minute-level data and refine slippage for intraday realities.
    acceptance_criteria:
      - "Minute bars session-aligned with DST."
      - "Time-of-day slippage model."
    features:
      - id: E7-F1
        title: Minute Bars Ingestion (US+EU)
        status: done
        tasks:
          - id: T601
            title: Loader with session alignment and memory notes
            status: done
            estimate: "1.0d"
            depends_on: [T004, T006]
            acceptance_criteria:
              - "Out-of-session data excluded; tests pass."
      - id: E7-F2
        title: Slippage v2 (Time-of-Day)
        status: done
        tasks:
          - id: T602
            title: Open/close spread widening + TOD buckets
            status: done
            estimate: "0.75d"
            depends_on: [T601, T105]
            acceptance_criteria:
              - "Model reflects open/close regimes."

  - id: E8
    title: Options (Phase 1, US Large-Cap/Index)
    status: done
    description: Limited options support with chains, IV, greeks, and early exercise.
    acceptance_criteria:
      - "Option chains ingested with IV present/derived."
      - "Greeks cached; valuation reproducible."
      - "Early exercise around dividends modeled."
    features:
      - id: E8-F1
        title: Options Data Schema + IV
        status: done
        tasks:
          - id: T701
            title: Chain schema + BS IV if missing
            status: done
            estimate: "1.0d"
            depends_on: [T001]
            acceptance_criteria:
              - "Parquet schema and IV tests."
      - id: E8-F2
        title: Greeks & Valuation Cache
        status: done
        tasks:
          - id: T702
            title: BS greeks with carry and div yields
            status: done
            estimate: "1.0d"
            depends_on: [T701]
            acceptance_criteria:
              - "Greeks match reference within tolerance."
      - id: E8-F3
        title: Assignment / Early Exercise
        status: done
        tasks:
          - id: T703
            title: Early ITM calls pre-div + assignment prob
            status: done
            estimate: "0.75d"
            depends_on: [T702, T003]
            acceptance_criteria:
              - "Backtests reflect early exercise cases."
      - id: E8-F4
        title: Options Strategy Helpers
        status: done
        tasks:
          - id: T704
            title: Covered call, vertical; roll rules
            status: done
            estimate: "0.75d"
            depends_on: [T702]
            acceptance_criteria:
              - "Helper builds valid legs; example run."

  - id: E9
    title: Observability, Artifacts, Docs, QA
    status: done
    description: Reproducibility, metrics, tests, and developer documentation.
    acceptance_criteria:
      - "Run artifacts written deterministically with manifest."
      - "Prometheus metrics available; Grafana dashboard JSON."
      - "Determinism and leakage tests in CI."
      - "Developer docs and runbooks committed."
    features:
      - id: E9-F1
        title: Artifacts & Manifest
        status: done
        tasks:
          - id: T301
            title: Write equity/orders/fills/metrics + run_manifest
            status: done
            estimate: "0.75d"
            acceptance_criteria:
              - "Hash of params and git SHA stored."
      - id: E9-F2
        title: Metrics & Dashboards
        status: done
        tasks:
          - id: T801
            title: Prometheus /metrics + Grafana board
            status: done
            estimate: "0.5d"
            depends_on: [T303]
            acceptance_criteria:
              - "Events/s, lag, slippage, error rates charted."
      - id: E9-F3
        title: Determinism & Leakage Tests
        status: done
        tasks:
          - id: T802
            title: Seed determinism test
            status: done
            estimate: "0.5d"
            depends_on: [T301]
            acceptance_criteria:
              - "Same seed → identical artifacts."
          - id: T803
            title: No-peek & survivorship tests
            status: done
            estimate: "0.5d"
            depends_on: [T007]
            acceptance_criteria:
              - "Access >asof fails; delist PIT OK."
      - id: E9-F4
        title: Developer Docs & Runbooks
        status: done
        tasks:
          - id: T804
            title: Guides (first strategy, costs, cron EOD, incident)
            status: done
            estimate: "1.0d"
            depends_on: [T203, T304, T305]
            acceptance_criteria:
              - "Docs build passes; examples run as documented."

  - id: E10
    title: Discovery: Fundamentals & Sector Stats (PIT)
    status: planned
    description: Point-in-time fundamentals ingestion, sector classification, medians, and baseline screener.
    acceptance_criteria:
      - "Point-in-time fundamentals (ratios and base statements) stored with snapshots."
      - "Sector classification and rolling sector medians available."
      - "Screener returns top-k by configured thresholds and percentiles."
    features:
      - id: E10-F1
        title: Fundamentals Schema & Snapshots
        status: planned
        tasks:
          - id: T901
            title: Define schemas (income, balance, cashflow, ratios) + snapshot writer
            status: planned
            estimate: "1.5d"
            depends_on: [T001]
            acceptance_criteria:
              - "PyArrow schemas defined; unit tests instantiate."
              - "Snapshot writer enforces asof and PIT guards."
      - id: E10-F2
        title: Provider Integration (FMP/Tiingo)
        status: planned
        tasks:
          - id: T902
            title: Ingest core fields (PE, EV/EBITDA, FCF yield, Debt/EBITDA, ROIC, interest coverage)
            status: planned
            estimate: "2.0d"
            acceptance_criteria:
              - "Universe ≥ 1k US tickers ingested."
              - "Null/negative earnings edge cases handled."
          - id: T903
            title: Sector classification and sector median calculators
            status: planned
            estimate: "1.0d"
            acceptance_criteria:
              - "Percentile vs sector computed per metric."
      - id: E10-F3
        title: Screener Engine v1
        status: planned
        tasks:
          - id: T904
            title: Universe/liquidity filters + threshold/percentile filters
            status: planned
            estimate: "1.0d"
            acceptance_criteria:
              - "Filters: regions, exchanges, min market cap, min ADDV."
          - id: T905
            title: Ranker and result writer (candidate list)
            status: planned
            estimate: "0.75d"
            acceptance_criteria:
              - "Top-k ranked with stored params and scores."

  - id: E11
    title: Discovery: Publications Ingestion & NLP
    status: planned
    description: Ingest SEC filings and transcripts; parse sections; compute tone, guidance deltas, and risk diffs.
    acceptance_criteria:
      - "EDGAR 10-K/10-Q/8-K fetched with metadata and stored."
      - "MD&A and Risk Factors chunked and searchable."
      - "Guidance vs consensus deltas and tone scores produced per filing/call."
    features:
      - id: E11-F1
        title: EDGAR Fetcher & Store
        status: planned
        tasks:
          - id: T906
            title: Ingest 10-K/10-Q/8-K + metadata (CIK, filing date) and index
            status: planned
            estimate: "2.0d"
            acceptance_criteria:
              - "Retry/SLA and rate-limits respected; 100 symbol pilot."
      - id: E11-F2
        title: Parsing, Chunking, Embeddings
        status: planned
        tasks:
          - id: T907
            title: Section detector (MD&A, Risk) + chunking + pgvector index
            status: planned
            estimate: "1.5d"
            acceptance_criteria:
              - "Top-3 relevant chunks retrievable per query."
      - id: E11-F3
        title: Guidance, Risk Diffs, Tone
        status: planned
        tasks:
          - id: T908
            title: Guidance extractor and consensus delta baseline
            status: planned
            estimate: "1.5d"
            acceptance_criteria:
              - "Delta vs scraped consensus for pilot set."
          - id: T909
            title: Risk factor diffing across filings
            status: planned
            estimate: "1.0d"
            acceptance_criteria:
              - "Changed/new/removed risk items flagged."
          - id: T910
            title: FinBERT tone on MD&A and call Q&A sections
            status: planned
            estimate: "0.75d"
            acceptance_criteria:
              - "Tone score in [-1,1] with simple calibration."

  - id: E12
    title: Discovery: News Ingestion & Event Sentiment
    status: planned
    description: Ingest and score recent news with entity resolution, event tagging, and sentiment with time decay.
    acceptance_criteria:
      - "News for candidates (7–30d) ingested with dedup/entity tags."
      - "Event taxonomy applied (M&A, downgrades, litigation, regulatory, product)."
      - "Aggregate sentiment with half-life decay computed per instrument."
    features:
      - id: E12-F1
        title: Provider Integration
        status: planned
        tasks:
          - id: T911
            title: Ingest Marketaux/Finnhub news (pilot) with pagination/retries
            status: planned
            estimate: "1.0d"
            acceptance_criteria:
              - "At least 30 days per symbol available."
      - id: E12-F2
        title: Entity/De-dup & Event Tagging
        status: planned
        tasks:
          - id: T912
            title: NER + clustering dedup + event classifier
            status: planned
            estimate: "1.5d"
            acceptance_criteria:
              - "Duplicate stories collapsed; events labeled."
      - id: E12-F3
        title: Sentiment & Decay Aggregation
        status: planned
        tasks:
          - id: T913
            title: FinBERT sentiment and half-life aggregation
            status: planned
            estimate: "0.75d"
            acceptance_criteria:
              - "Per-instrument sentiment score produced."

  - id: E13
    title: Discovery: Composite Scoring & Explainability
    status: planned
    description: Combine fundamentals, publications, and news into a composite score with hard gates and human-readable explanations.
    acceptance_criteria:
      - "Composite score computed with configurable weights."
      - "Hard gates exclude high-risk cases; reasons recorded."
      - "Explanations include numeric metrics, deltas, and news snippets."
    features:
      - id: E13-F1
        title: Scoring & Gates
        status: planned
        tasks:
          - id: T914
            title: Implement composite scoring and gating per strategy template
            status: planned
            estimate: "1.0d"
            acceptance_criteria:
              - "Scores reproducible from stored inputs."
      - id: E13-F2
        title: Explainability Store
        status: planned
        tasks:
          - id: T915
            title: Persist candidate_explanations with references to docs/news
            status: planned
            estimate: "0.75d"
            acceptance_criteria:
              - "GET /explain returns structured reasons."

  - id: E14
    title: Discovery: API & Service
    status: planned
    description: Expose screening runs and explanations via HTTP.
    acceptance_criteria:
      - "POST /strategies/run returns run_id."
      - "GET /strategies/{run_id}/results returns ranked candidates."
      - "GET /instruments/{ticker}/explain returns explanations."
    features:
      - id: E14-F1
        title: Endpoints & Pydantic Models
        status: planned
        tasks:
          - id: T916
            title: Implement /strategies/run, /results, /explain endpoints
            status: planned
            estimate: "1.0d"
            depends_on: [T904, T915]
            acceptance_criteria:
              - "Schemas validated; error handling with 400/500 paths."
      - id: E14-F2
        title: Strategy Templates
        status: planned
        tasks:
          - id: T917
            title: Prebuilt value_long_term template with thresholds/weights validation
            status: planned
            estimate: "0.5d"
            acceptance_criteria:
              - "Template persisted; can run via API."

  - id: E15
    title: Discovery: Backtesting
    status: planned
    description: Point-in-time evaluation of screened portfolios on quarterly cadence.
    acceptance_criteria:
      - "Quarterly snapshots used; no leakage."
      - "Metrics: hit rate, forward returns, drawdown."
    features:
      - id: E15-F1
        title: Snapshot Runner
        status: planned
        tasks:
          - id: T918
            title: Build quarterly snapshot/backtest runner using research harness
            status: planned
            estimate: "1.0d"
            depends_on: [T901, T904]
            acceptance_criteria:
              - "Artifacts written per run; reproducible."
      - id: E15-F2
        title: Backtest Metrics
        status: planned
        tasks:
          - id: T919
            title: Compute forward 3/6/12m returns and drawdown
            status: planned
            estimate: "0.75d"
            acceptance_criteria:
              - "CSV/JSON metrics persisted."

  - id: E16
    title: Discovery: Options Overlay
    status: planned
    description: Optional overlay recommendations (cash-secured puts, covered calls) for candidates.
    acceptance_criteria:
      - "Options chains ingested for selected symbols."
      - "Overlay suggestions with breakeven and annualized yield."
    features:
      - id: E16-F1
        title: Options Chain Ingestion
        status: planned
        tasks:
          - id: T920
            title: Ingest and cache options chains; compute IV vs HV
            status: planned
            estimate: "1.5d"
            acceptance_criteria:
              - "Chain coverage for ≥50 symbols."
      - id: E16-F2
        title: Overlay Recommender
        status: planned
        tasks:
          - id: T921
            title: Cash-secured puts (20–30 delta) and covered calls recommender
            status: planned
            estimate: "1.0d"
            acceptance_criteria:
              - "Output includes strike, premium, breakeven, APY."

  - id: E17
    title: Discovery: Orchestration & Alerts
    status: planned
    description: Nightly scheduling, webhooks, and alerting via n8n.
    acceptance_criteria:
      - "Nightly run; failures retried; alerts delivered."
    features:
      - id: E17-F1
        title: n8n Workflow
        status: planned
        tasks:
          - id: T922
            title: Nightly run trigger + Slack/Email top-k
            status: planned
            estimate: "0.5d"
            acceptance_criteria:
              - "Workflow executes end-to-end."
      - id: E17-F2
        title: Webhooks & Retries
        status: planned
        tasks:
          - id: T923
            title: EDGAR webhook, HTTP retries, logging
            status: planned
            estimate: "0.5d"
            acceptance_criteria:
              - "Resilient to transient provider errors."
