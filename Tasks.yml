roadmap:
  version: "0.1"
  updated: "2025-08-11"
  scope:
    markets: ["US", "EU"]
    latencies: ["EOD", "minute (later)"]
    base_currency: "EUR"
    interfaces_now: ["CLI", "HTTP (FastAPI)"]
    interfaces_later: ["gRPC", "Prefect"]
    parallelism: "multiprocessing"
  statuses_allowed: ["planned", "in_progress", "blocked", "done"]

epics:
  - id: E1
    title: Data Foundation (US+EU, FX, Calendars)
    status: done
    description: Point-in-time, survivorship-bias-free data with corporate actions, FX, and exchange calendars.
    acceptance_criteria:
      - "Schemas defined in PyArrow and documented."
      - "PIT symbol queries correct across active_from/active_to."
      - "Split/dividend adjustments validated."
      - "FX PIT queries and weekend handling validated."
      - "Calendars cover XNYS,XNAS,XETR,XLON,XPAR,XAMS,XBRU,SIX with DST/holidays."
    features:
      - id: E1-F1
        title: Arrow/Parquet Schemas
        status: done
        tasks:
          - id: T001
            title: Define schemas (bars, fx, corp_actions, symbols)
            status: done
            estimate: "0.5d"
            acceptance_criteria:
              - "Python constants in /data/schemas."
              - "Unit test instantiates each schema."
      - id: E1-F2
        title: Symbol Master + PIT
        status: done
        tasks:
          - id: T002
            title: Loader (CSV→Postgres) and PIT SELECTs
            status: done
            estimate: "1.0d"
            depends_on: [T001]
            acceptance_criteria:
              - "`get_symbols(asof)` returns only active rows."
              - "Tests cover survivorship bias with delistings."
      - id: E1-F3
        title: Corporate Actions
        status: done
        tasks:
          - id: T003
            title: Loader (CSV→Parquet) and adjusters
            status: done
            estimate: "1.0d"
            depends_on: [T002]
            acceptance_criteria:
              - "2:1 split halves price, doubles qty in P&L."
              - "Dividend cashflow reflected on ex-date."
      - id: E1-F4
        title: Exchange Calendars (US+EU)
        status: done
        tasks:
          - id: T004
            title: Calendar module (is_open/next_open/next_close)
            status: done
            estimate: "1.0d"
            acceptance_criteria:
              - "NYSE closed July 4; XETR half-day Dec 24 test passes."
      - id: E1-F5
        title: FX Rates (EUR base)
        status: done
        tasks:
          - id: T005
            title: FX ingestion (daily+minute) and PIT reader
            status: done
            estimate: "0.75d"
            depends_on: [T001]
            acceptance_criteria:
              - "USD/EUR, GBP/EUR, CHF/EUR stored."
              - "Weekend queries return last available."
      - id: E1-F6
        title: Bars Ingestion (Daily, US+EU)
        status: done
        tasks:
          - id: T006
            title: CSV→Parquet loader with validation
            status: done
            estimate: "1.0d"
            depends_on: [T001, T004]
            acceptance_criteria:
              - "UTC-normalized closes; gaps/NaNs flagged."
      - id: E1-F7
        title: PIT Data Reader API
        status: done
        tasks:
          - id: T007
            title: get_bars/get_fx with no-peek guard
            status: done
            estimate: "1.0d"
            depends_on: [T002, T003, T006]
            acceptance_criteria:
              - "Access beyond asof raises error; tests included."
      - id: E1-F8
        title: Region-Aware Cost Profiles
        status: done
        tasks:
          - id: T008
            title: YAML cost profiles per venue (US/EU)
            status: done
            estimate: "0.5d"
            acceptance_criteria:
              - "US per-share+SEC/TAF; EU bps; UK stamp duty toggle."

  - id: E2
    title: Engine Core (Events, Clock, Portfolio, Execution, Risk)
    status: done
    description: Deterministic event-driven simulator with multi-currency portfolio and realistic costs.
    acceptance_criteria:
      - "Deterministic event ordering."
      - "Accurate P&L with splits/dividends and FX."
      - "Fills respect spread and liquidity."
      - "Risk limits enforced."
    features:
      - id: E2-F1
        title: Events & Clock
        status: done
        tasks:
                      - id: T101
              title: Event types & priority queue
              status: done
            estimate: "0.75d"
            depends_on: [T007]
            acceptance_criteria:
              - "Bar/FX/CorpAction/Clock ordering test passes."
          - id: T102
            title: Deterministic clock (UTC, exchange-aware)
            status: done
            estimate: "0.5d"
            depends_on: [T101, T004]
            acceptance_criteria:
              - "No time travel; mixed feeds tested."
      - id: E2-F2
        title: Portfolio (Multi-Currency)
        status: done
        tasks:
                      - id: T103
              title: Positions, cash per CCY, EUR valuation
              status: done
            estimate: "1.5d"
            depends_on: [T005]
            acceptance_criteria:
              - "Realized/unrealized P&L correct across corp actions."
      - id: E2-F3
        title: Orders & Execution
        status: done
        tasks:
                      - id: T104
              title: Order state machine (NEW→WORKING→FILLED/CANCELED)
              status: done
            estimate: "0.75d"
            depends_on: [T101]
            acceptance_criteria:
              - "IOC/FOK/Day lifecycle tests."
                      - id: T105
              title: Execution simulator v1 (spread+liquidity)
              status: done
            estimate: "1.0d"
            depends_on: [T104, T006]
            acceptance_criteria:
              - "Fills within [bid, ask]; partials under ADV cap."
                      - id: T106
              title: Commission & fees plugin (US/EU)
              status: done
            estimate: "0.5d"
            depends_on: [T008]
            acceptance_criteria:
              - "Venue overrides applied; regression tests."
                      - id: T107
              title: Market impact (square-root)
              status: done
            estimate: "0.5d"
            depends_on: [T105]
            acceptance_criteria:
              - "Impact scales with sqrt(qty/ADV); unit tests."
      - id: E2-F4
        title: Risk Limits
        status: done
        tasks:
                      - id: T108
              title: Gross/net, per-symbol, leverage caps
              status: done
            estimate: "0.75d"
            depends_on: [T103]
            acceptance_criteria:
              - "Breaches block orders; logs include reason."

  - id: E3
    title: Strategy SDK & Features
    status: done
    description: Python SDK for writing strategies with context, data access, order APIs, and core indicators.
    acceptance_criteria:
      - "Strategy base class with ctx methods."
      - "Feature library validated against reference calcs."
      - "Example strategies runnable."
    features:
      - id: E3-F1
        title: Strategy Base & Context
        status: done
        tasks:
                      - id: T201
              title: Implement base & ctx (data/order/portfolio/risk/log)
              status: done
            estimate: "1.0d"
            depends_on: [T101, T103, T105]
            acceptance_criteria:
              - "Mock strategy receives expected events."
      - id: E3-F2
        title: Feature Library v1
        status: done
        tasks:
                      - id: T202
              title: MA, zscore, rolling vol, ATR, vol-target
              status: done
            estimate: "0.75d"
            depends_on: [T201]
            acceptance_criteria:
              - "Vectorized; unit tests pass."
      - id: E3-F3
        title: Example Strategies
        status: done
        tasks:
                      - id: T203
              title: MA cross and vol-targeted carry
              status: done
            estimate: "0.75d"
            depends_on: [T202]
            acceptance_criteria:
              - "Baseline metrics snapshot committed."

  - id: E4
    title: Orchestration & Service (CLI, HTTP, cron)
    status: done
    description: Expose backtests and signals via CLI and FastAPI; cron-aligned EOD runs.
    acceptance_criteria:
      - "CLI for backtest/signal/data ingest."
      - "HTTP /backtest and /signal return JSON artifacts."
      - "Cron scripts align to exchange close with retry."
    features:
      - id: E4-F1
        title: CLI
        status: done
        tasks:
          - id: T302
            title: Commands: run backtest|signal, data ingest
            status: done
            estimate: "0.75d"
            depends_on: [T201, T301]
            acceptance_criteria:
              - "Exit codes + help texts."
      - id: E4-F2
        title: FastAPI Service
        status: done
        tasks:
          - id: T303
            title: /health, /backtest, /signal (pydantic models)
            status: done
            estimate: "1.0d"
            depends_on: [T201, T301]
            acceptance_criteria:
              - "JSON logs; schema-validated requests."
      - id: E4-F3
        title: Containerization & Config
        status: done
        tasks:
          - id: T304
            title: Dockerfile/compose + pydantic config + .env
            status: done
            estimate: "0.5d"
            depends_on: [T303]
            acceptance_criteria:
              - "Service runs locally via docker-compose."
      - id: E4-F4
        title: Cron Runners
        status: done
        tasks:
          - id: T305
            title: Exchange-close cron scripts with offsets
            status: done
            estimate: "0.5d"
            depends_on: [T303, T004]
            acceptance_criteria:
              - "Retry on failure; timezone-safe schedule."

  - id: E5
    title: Paper & Live Execution Abstractions
    status: done
    description: Unified execution layer so strategies run unchanged in backtest, paper, or live.
    acceptance_criteria:
      - "Paper broker with same slippage/fees path."
      - "Execution provider interface."
      - "IBKR adapter skeleton (paper only)."
    features:
      - id: E5-F1
        title: Paper Broker
        status: done
        tasks:
          - id: T401
            title: In-memory order book, partial fills, cancel/replace
            status: done
            estimate: "1.0d"
            depends_on: [T105, T106]
            acceptance_criteria:
              - "Tick-size compliance US/EU; tests pass."
      - id: E5-F2
        title: Execution Provider Interface
        status: done
        tasks:
          - id: T402
            title: submit/cancel/status with unified errors
            status: done
            estimate: "0.5d"
            depends_on: [T401]
            acceptance_criteria:
              - "Mock adapter integration test."
      - id: E5-F3
        title: IBKR Adapter (skeleton)
        status: done
        tasks:
          - id: T403
            title: Auth, clock sync, dry-run guard (paper-only)
            status: done
            estimate: "1.0d"
            depends_on: [T402]
            acceptance_criteria:
              - "End-to-end dry-run through adapter."

  - id: E6
    title: Research & Validation (Walk-Forward, Hyperparam)
    status: done
    description: Leakage-safe validation and multiprocessing hyperparameter search.
    acceptance_criteria:
      - "Walk-forward & purged k-fold implemented."
      - "MP grid/random search with deterministic seeds."
    features:
      - id: E6-F1
        title: Walk-Forward & Purged K-Fold
        status: done
        tasks:
          - id: T501
            title: API with per-fold artifacts and leakage guards
            status: done
            estimate: "1.0d"
            depends_on: [T302]
            acceptance_criteria:
              - "No overlap; artifacts per fold saved."
      - id: E6-F2
        title: Hyperparameter Search (MP)
        status: done
        tasks:
          - id: T502
            title: Grid/random search; leaderboard.csv
            status: done
            estimate: "0.75d"
            depends_on: [T501]
            acceptance_criteria:
              - "Reproducible with fixed seeds."

  - id: E7
    title: Minute Bars & EU Specifics
    status: planned
    description: Add minute-level data and refine slippage for intraday realities.
    acceptance_criteria:
      - "Minute bars session-aligned with DST."
      - "Time-of-day slippage model."
    features:
      - id: E7-F1
        title: Minute Bars Ingestion (US+EU)
        status: planned
        tasks:
          - id: T601
            title: Loader with session alignment and memory notes
            status: planned
            estimate: "1.0d"
            depends_on: [T004, T006]
            acceptance_criteria:
              - "Out-of-session data excluded; tests pass."
      - id: E7-F2
        title: Slippage v2 (Time-of-Day)
        status: planned
        tasks:
          - id: T602
            title: Open/close spread widening + TOD buckets
            status: planned
            estimate: "0.75d"
            depends_on: [T601, T105]
            acceptance_criteria:
              - "Model reflects open/close regimes."

  - id: E8
    title: Options (Phase 1, US Large-Cap/Index)
    status: planned
    description: Limited options support with chains, IV, greeks, and early exercise.
    acceptance_criteria:
      - "Option chains ingested with IV present/derived."
      - "Greeks cached; valuation reproducible."
      - "Early exercise around dividends modeled."
    features:
      - id: E8-F1
        title: Options Data Schema + IV
        status: planned
        tasks:
          - id: T701
            title: Chain schema + BS IV if missing
            status: planned
            estimate: "1.0d"
            depends_on: [T001]
            acceptance_criteria:
              - "Parquet schema and IV tests."
      - id: E8-F2
        title: Greeks & Valuation Cache
        status: planned
        tasks:
          - id: T702
            title: BS greeks with carry and div yields
            status: planned
            estimate: "1.0d"
            depends_on: [T701]
            acceptance_criteria:
              - "Greeks match reference within tolerance."
      - id: E8-F3
        title: Assignment / Early Exercise
        status: planned
        tasks:
          - id: T703
            title: Early ITM calls pre-div + assignment prob
            status: planned
            estimate: "0.75d"
            depends_on: [T702, T003]
            acceptance_criteria:
              - "Backtests reflect early exercise cases."
      - id: E8-F4
        title: Options Strategy Helpers
        status: planned
        tasks:
          - id: T704
            title: Covered call, vertical; roll rules
            status: planned
            estimate: "0.75d"
            depends_on: [T702]
            acceptance_criteria:
              - "Helper builds valid legs; example run."

  - id: E9
    title: Observability, Artifacts, Docs, QA
    status: planned
    description: Reproducibility, metrics, tests, and developer documentation.
    acceptance_criteria:
      - "Run artifacts written deterministically with manifest."
      - "Prometheus metrics available; Grafana dashboard JSON."
      - "Determinism and leakage tests in CI."
      - "Developer docs and runbooks committed."
    features:
      - id: E9-F1
        title: Artifacts & Manifest
        status: done
        tasks:
          - id: T301
            title: Write equity/orders/fills/metrics + run_manifest
            status: done
            estimate: "0.75d"
            acceptance_criteria:
              - "Hash of params and git SHA stored."
      - id: E9-F2
        title: Metrics & Dashboards
        status: planned
        tasks:
          - id: T801
            title: Prometheus /metrics + Grafana board
            status: planned
            estimate: "0.5d"
            depends_on: [T303]
            acceptance_criteria:
              - "Events/s, lag, slippage, error rates charted."
      - id: E9-F3
        title: Determinism & Leakage Tests
        status: planned
        tasks:
          - id: T802
            title: Seed determinism test
            status: planned
            estimate: "0.5d"
            depends_on: [T301]
            acceptance_criteria:
              - "Same seed → identical artifacts."
          - id: T803
            title: No-peek & survivorship tests
            status: planned
            estimate: "0.5d"
            depends_on: [T007]
            acceptance_criteria:
              - "Access >asof fails; delist PIT OK."
      - id: E9-F4
        title: Developer Docs & Runbooks
        status: planned
        tasks:
          - id: T804
            title: Guides (first strategy, costs, cron EOD, incident)
            status: planned
            estimate: "1.0d"
            depends_on: [T203, T304, T305]
            acceptance_criteria:
              - "Docs build passes; examples run as documented."
